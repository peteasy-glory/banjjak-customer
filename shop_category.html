<?
include($_SERVER['DOCUMENT_ROOT']."/include/global.php");
include($_SERVER['DOCUMENT_ROOT']."/include/skin/header.php");

$user_id = (isset($_SESSION['gobeauty_user_id'])) ? $_SESSION['gobeauty_user_id'] : "";
$user_name = (isset($_SESSION['gobeauty_user_nickname'])) ? $_SESSION['gobeauty_user_nickname'] : "";

$pet_type = (isset($_GET['pet_type']))? $_GET['pet_type'] : "dog";
$category = (isset($_GET["category"]))? $_GET["category"] : "3";
$category_sql = "SELECT * FROM tb_item_category WHERE ic_seq = '".$category."'";
$category_result = sql_query($category_sql);
$category_row = sql_fetch($category_result);

$main_category = $category_row['parent_seq'];

if($pet_type == "cat"){
    $best_item = "a.is_view_main_9";
}else{
    $best_item = "a.is_view_main_5";
}

// 베스트 쇼핑템
$best_item_sql = "
    SELECT * FROM tb_item_list a
        LEFT JOIN (
                SELECT product_no p_no, AVG(rating) rating_avg, COUNT(product_no) AS rating_cnt 
                FROM tb_item_review WHERE rating IS NOT NULL AND is_delete = '2' GROUP BY product_no
                ) b ON b.p_no = a.product_no
    WHERE a.is_delete = '1' AND {$best_item} = '1' AND a.is_view = '1' AND a.is_soldout = '1' ORDER BY a.reg_dt desc";
$best_item_array = sql_fetch_array($best_item_sql);

//돌아갈 url을 세션에 저장한다.
unset($_SESSION['backurl_shop']);
$_SESSION['backurl_shop'] = $_SERVER[ "REQUEST_URI" ];

?>

<article id="appDownloadPopup" class="layer-pop-wrap actived" onclick="pop.close('#appDownloadPopup'); document.getElementById('appDownloadTop').classList.add('actived')">
    <div class="layer-pop-jack">
        <div class="layer-pop-jack-top">
            <div class="layer-pop-jack-top-left">
                <img src="images/app_logo2.png" alt="">

            </div>
            <div class="layer-pop-jack-top-right">
                <strong>첫 구매 시 <storng style="color:#e74f55">최대 3,000원</storng> 할인!</strong><br>
                <span>미용예약 	&#183; 산책 	&#183; 쇼핑까지!</span><br>
                <span>이제 반짝하세요!</span>
            </div>

        </div>
        <div class="layer-pop-jack-bottom">
            <div class="layer-pop-jack-bottom-top">
                <a href="#" class="app-download-link" ><strong >반짝 앱 다운받기</strong></a>

            </div>
            <div class="layer-pop-jack-bottom-bottom">
                <span onclick="pop.close('#appDownloadPopup'); setCookie_popup('appDownloadpopup','Y',1); document.getElementById('appDownloadTop').classList.add('actived')">괜찮아요, 모바일 웹으로 볼래요.</span>
            </div>


        </div>

    </div>



</article>

<article id="appDownloadTop" class="layer-top-wrap">
    <div class="layer-top">

        <div class="layer-top-1">
            <img src="images/app_logo2.png" alt="">
        </div>
        <div class="layer-top-2">
            <span>앱 설치하고 회원가입 시</span><br>
            <strong><strong style="color:#e74f55">최대 3,000원</strong> 할인!</strong>
        </div>
        <div class="layer-top-3">
            <a href="#" class="app-download-link" ><strong >앱 다운로드</strong></a>
        </div>
        <div class="layer-top-4">
            <img src="images/btn_close.png" alt="" onclick="document.getElementById('appDownloadTop').classList.remove('actived'); document.getElementById('appDownloadTop').style.display = 'none'; setCookie_popup('appDownloadTop','Y',1);">
        </div>
    </div>
</article>

<script>


    $('.layer-pop-jack').click(function(event){
        event.stopPropagation();

    })
    // 팝업
    function getCookie_popup(name) {
        var obj = name + "=";
        var x = 0;
        while (x <= document.cookie.length) {
            var y = (x + obj.length);
            if (document.cookie.substring(x, y) == obj) {
                if ((endOfCookie = document.cookie.indexOf(";", y)) == -1)
                    endOfCookie = document.cookie.length;
                return unescape(document.cookie.substring(y, endOfCookie));
            }
            x = document.cookie.indexOf(" ", x) + 1;
            if (x == 0)
                break;
        }
        return "";
    }

    function setCookie_popup(name, value, expiredays) {
        var todayDate = new Date();
        todayDate.setDate(todayDate.getDate() + expiredays);
        document.cookie = name + '=' + escape(value) + '; path=/; expires=' + todayDate.toGMTString() + '; SameSite=None; Secure ';
    }


    let userAgent =  navigator.userAgent;
    //window 거나 and app 이거나 ios app 인경우 다운로드 popup 비활성화
    if(userAgent.match(/window/i) || userAgent.match(/app_gobeauty_and/i) || userAgent.match(/app_gobeauty_ios/i)){
        document.getElementById('appDownloadPopup').classList.remove('actived');
    }

    if(getCookie_popup('appDownloadpopup') === 'Y'){
        document.getElementById('appDownloadPopup').classList.remove('actived');
    }

    if(getCookie_popup('appDownloadTop') === 'Y'){
        document.getElementById('appDownloadTop').classList.remove('actived');
    }

</script>
<!-- header -->
<header id="header">	
	<div class="header-left">
		<a href="<?=$_SESSION['backurl1']?>" class="btn-page-ui btn-page-prev"><div class="icon icon-size-24 icon-page-prev">페이지 뒤로가기</div></a>
	</div>
	<div class="page-title"><?=$category_row['cate_name']?></div>
</header>
<!-- //header -->

<!-- container -->
<section id="container"> 
	<!-- page-body -->    
	<div class="page-body fix-bottom-page">
		<div class="shop-category-wrap">
			<div class="wide-tab">
				<div class="wide-tab-inner">
					<!-- 활성화시 actived클래스 추가 -->
                    <?php
                    if($pet_type == 'cat'){
                        ?>
                        <div class="tab-cell actived"><a href="javascript:click_tab(52);" class="btn-tab-item" id="middle_category_52">사료</a></div>
                        <div class="tab-cell"><a href="javascript:click_tab(61);" class="btn-tab-item" id="middle_category_61">간식</a></div>
                        <div class="tab-cell"><a href="javascript:click_tab(74);" class="btn-tab-item" id="middle_category_74">용품</a></div>
                        <?php
                    }else{
                        ?>
                        <div class="tab-cell actived"><a href="javascript:click_tab(2);" class="btn-tab-item" id="middle_category_2">사료</a></div>
                        <div class="tab-cell"><a href="javascript:click_tab(12);" class="btn-tab-item" id="middle_category_12">간식</a></div>
                        <div class="tab-cell"><a href="javascript:click_tab(27);" class="btn-tab-item" id="middle_category_27">용품</a></div>
                        <?php
                    }
                    ?>
				</div>
			</div>
            <div class="shop-category-menu">
                <!--<div class="swiper-container">
                    <div class="swiper-wrapper">
                    </div>
                </div>
                <div class="swiper-page"></div>-->
            </div>

            <?php
            if($pet_type == 'cat'){
            ?>
            <!--<div class="shop-category-menu last_category_2" style="display:none;">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(3,'퍼피(1세미만)');" class="middle_category actived" data-id="3">퍼피(1세미만)</a>
                                <a href="javascript:click_category(4,'어덜트(1-6세)');" class="middle_category" data-id="4">어덜트(1-6세)</a>
                                <a href="javascript:click_category(5,'시니어(7세이상)');" class="middle_category" data-id="5">시니어(7세이상)</a>
                                <a href="javascript:click_category(6,'전연령');" class="middle_category" data-id="6">전연령</a>
                                <a href="javascript:click_category(7,'습식사료');" class="middle_category" data-id="7">습식사료</a>
                                <a href="javascript:click_category(8,'자연식');" class="middle_category" data-id="8">자연식</a>
                                <a href="javascript:click_category(9,'에어/동결사료');" class="middle_category" data-id="9">에어/동결사료</a>
                                <a href="javascript:click_category(10,'건식사료');" class="middle_category" data-id="10">건식사료</a>
                                <a href="javascript:click_category(11,'소프트사료');" class="middle_category" data-id="11">소프트사료</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-page"></div>
            </div>

            <div class="shop-category-menu last_category_12" style="display:none;">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(13,'수제간식');" class="middle_category actived" data-id="13">수제간식</a>
                                <a href="javascript:click_category(14,'빵/케이크');" class="middle_category" data-id="14">빵/케이크</a>
                                <a href="javascript:click_category(15,'덴탈껌');" class="middle_category" data-id="15">덴탈껌</a>
                                <a href="javascript:click_category(16,'뼈간식');" class="middle_category" data-id="16">뼈간식</a>
                                <a href="javascript:click_category(17,'껌');" class="middle_category" data-id="17">껌</a>
                                <a href="javascript:click_category(18,'동결/건조');" class="middle_category" data-id="18">동결/건조</a>
                                <a href="javascript:click_category(19,'저키/트릿');" class="middle_category" data-id="19">저키/트릿</a>
                                <a href="javascript:click_category(20,'사시미/육포');" class="middle_category" data-id="20">사시미/육포</a>
                                <a href="javascript:click_category(21,'캔/파우치');" class="middle_category" data-id="21">캔/파우치</a>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(22,'소시지');" class="middle_category" data-id="22">소시지</a>
                                <a href="javascript:click_category(23,'비스켓/쿠키');" class="middle_category" data-id="23">비스켓/쿠키</a>
                                <a href="javascript:click_category(24,'파우더');" class="middle_category" data-id="24">파우더</a>
                                <a href="javascript:click_category(25,'우유/분유/음료');" class="middle_category" data-id="25">우유/분유/음료</a>
                                <a href="javascript:click_category(26,'영양제');" class="middle_category" data-id="26">영양제</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-page"></div>
            </div>

            <div class="shop-category-menu last_category_27" style="display:none;">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(28,'배변용품');" class="middle_category actived" data-id="28">배변용품</a>
                                <a href="javascript:click_category(29,'위생용품');" class="middle_category" data-id="29">위생용품</a>
                                <a href="javascript:click_category(30,'칫솔/치약');" class="middle_category" data-id="30">칫솔/치약</a>
                                <a href="javascript:click_category(31,'미용/관리');" class="middle_category" data-id="31">미용/관리</a>
                                <a href="javascript:click_category(32,'목욕용품');" class="middle_category" data-id="32">목욕용품</a>
                                <a href="javascript:click_category(33,'장난감');" class="middle_category" data-id="33">장난감</a>
                                <a href="javascript:click_category(34,'노즈워크');" class="middle_category" data-id="34">노즈워크</a>
                                <a href="javascript:click_category(35,'훈련용품');" class="middle_category" data-id="35">훈련용품</a>
                                <a href="javascript:click_category(36,'산책용품');" class="middle_category" data-id="36">산책용품</a>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(37,'하우스/방석');" class="middle_category" data-id="37">하우스/방석</a>
                                <a href="javascript:click_category(38,'울타리/안전문');" class="middle_category" data-id="38">울타리/안전문</a>
                                <a href="javascript:click_category(39,'이동장/유아차');" class="middle_category" data-id="39">이동장/유아차</a>
                                <a href="javascript:click_category(40,'가방/카시트');" class="middle_category" data-id="40">가방/카시트</a>
                                <a href="javascript:click_category(41,'의류/액세서리');" class="middle_category" data-id="41">의류/액세서리</a>
                                <a href="javascript:click_category(42,'급식기/급수기');" class="middle_category" data-id="42">급식기/급수기</a>
                                <a href="javascript:click_category(43,'정수기/자동급식기');" class="middle_category" data-id="43">정수기/자동급식기</a>
                                <a href="javascript:click_category(44,'기저귀');" class="middle_category" data-id="44">기저귀</a>
                                <a href="javascript:click_category(45,'사료통/사료삽');" class="middle_category" data-id="45">사료통/사료삽</a>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(46,'넥카라/수술');" class="middle_category" data-id="46">넥카라/수술</a>
                                <a href="javascript:click_category(47,'반려인 용품');" class="middle_category" data-id="47">반려인 용품</a>
                                <a href="javascript:click_category(48,'파티');" class="middle_category" data-id="48">파티</a>
                                <a href="javascript:click_category(49,'스탭/매트');" class="middle_category" data-id="49">스탭/매트</a>
                                <a href="javascript:click_category(50,'건강관리');" class="middle_category" data-id="50">건강관리</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-page"></div>
            </div>-->
                <?php

                }else{
                ?>
            <!--<div class="shop-category-menu last_category_52" style="display:none;">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(53,'키튼(1세미만)');" class="middle_category actived" data-id="53">키튼(1세미만)</a>
                                <a href="javascript:click_category(54,'어덜트(1-6세)');" class="middle_category" data-id="54">어덜트(1-6세)</a>
                                <a href="javascript:click_category(55,'시니어(7세이상)');" class="middle_category" data-id="55">시니어(7세이상)</a>
                                <a href="javascript:click_category(56,'전연령');" class="middle_category" data-id="56">전연령</a>
                                <a href="javascript:click_category(57,'에어/동결사료');" class="middle_category" data-id="57">에어/동결사료</a>
                                <a href="javascript:click_category(58,'건식사료');" class="middle_category" data-id="58">건식사료</a>
                                <a href="javascript:click_category(59,'주식캔');" class="middle_category" data-id="59">주식캔</a>
                                <a href="javascript:click_category(60,'파우치');" class="middle_category" data-id="60">파우치</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-page"></div>
            </div>

            <div class="shop-category-menu last_category_61" style="display:none;">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(62,'간식캔');" class="middle_category actived" data-id="62">간식캔</a>
                                <a href="javascript:click_category(63,'간식 파우치');" class="middle_category" data-id="63">간식 파우치</a>
                                <a href="javascript:click_category(64,'동결/건조');" class="middle_category" data-id="64">동결/건조</a>
                                <a href="javascript:click_category(65,'수제간식');" class="middle_category" data-id="65">수제간식</a>
                                <a href="javascript:click_category(66,'캣닢/캣그라스');" class="middle_category" data-id="66">캣닢/캣그라스</a>
                                <a href="javascript:click_category(67,'저키/스틱');" class="middle_category" data-id="67">저키/스틱</a>
                                <a href="javascript:click_category(68,'스낵');" class="middle_category" data-id="68">스낵</a>
                                <a href="javascript:click_category(69,'통살/소시지');" class="middle_category" data-id="69">통살/소시지</a>
                                <a href="javascript:click_category(70,'덴탈간식');" class="middle_category" data-id="70">덴탈간식</a>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(71,'파우더');" class="middle_category" data-id="71">파우더</a>
                                <a href="javascript:click_category(72,'우유/분유/음료');" class="middle_category" data-id="72">우유/분유/음료</a>
                                <a href="javascript:click_category(73,'영양제');" class="middle_category" data-id="73">영양제</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-page"></div>
            </div>

            <div class="shop-category-menu last_category_74" style="display:none;">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(75,'응고형모래');" class="middle_category actived" data-id="75">응고형모래</a>
                                <a href="javascript:click_category(76,'흡수형모래');" class="middle_category" data-id="76">흡수형모래</a>
                                <a href="javascript:click_category(77,'낚시대/레이져');" class="middle_category" data-id="77">낚시대/레이져</a>
                                <a href="javascript:click_category(78,'공/인형');" class="middle_category" data-id="78">공/인형</a>
                                <a href="javascript:click_category(79,'터널/사냥본능');" class="middle_category" data-id="79">터널/사냥본능</a>
                                <a href="javascript:click_category(80,'스크레쳐/박스');" class="middle_category" data-id="80">스크레쳐/박스</a>
                                <a href="javascript:click_category(81,'칫솔/치약');" class="middle_category" data-id="81">칫솔/치약</a>
                                <a href="javascript:click_category(82,'미용/관리');" class="middle_category" data-id="82">미용/관리</a>
                                <a href="javascript:click_category(83,'목욕용품');" class="middle_category" data-id="83">목욕용품</a>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(84,'위생용품');" class="middle_category" data-id="84">위생용품</a>
                                <a href="javascript:click_category(85,'의류/엑세서리');" class="middle_category" data-id="85">의류/엑세서리</a>
                                <a href="javascript:click_category(86,'하네스');" class="middle_category" data-id="86">하네스</a>
                                <a href="javascript:click_category(87,'이동장/유아차');" class="middle_category" data-id="87">이동장/유아차</a>
                                <a href="javascript:click_category(88,'급식기/급수기');" class="middle_category" data-id="88">급식기/급수기</a>
                                <a href="javascript:click_category(89,'정수기/자동급식기');" class="middle_category" data-id="89">정수기/자동급식기</a>
                                <a href="javascript:click_category(90,'화장실/배변보조');" class="middle_category" data-id="90">화장실/배변보조</a>
                                <a href="javascript:click_category(91,'하우스/방석');" class="middle_category" data-id="91">하우스/방석</a>
                                <a href="javascript:click_category(92,'캣타워/캣휠');" class="middle_category" data-id="92">캣타워/캣휠</a>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="shop-category-menu-list">
                                <a href="javascript:click_category(93,'사료통/사료삽');" class="middle_category" data-id="93">사료통/사료삽</a>
                                <a href="javascript:click_category(94,'넥카라/수술');" class="middle_category" data-id="94">넥카라/수술</a>
                                <a href="javascript:click_category(95,'반려인 용품');" class="middle_category" data-id="95">반려인 용품</a>
                                <a href="javascript:click_category(96,'파티');" class="middle_category" data-id="96">파티</a>
                                <a href="javascript:click_category(97,'울타리/안전문');" class="middle_category" data-id="97">울타리/안전문</a>
                                <a href="javascript:click_category(98,'먹이퍼즐');" class="middle_category" data-id="98">먹이퍼즐</a>
                                <a href="javascript:click_category(99,'건강관리');" class="middle_category" data-id="99">건강관리</a>
                                <a href="javascript:click_category(100,'자동장난감');" class="middle_category" data-id="100">자동장난감</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-page"></div>
            </div>-->
                <?php
                }
                ?>

			<div class="basic-data-group middle">
				<div class="con-title-group">
					<h4 class="con-title">인기상품</h4>
				</div>
				<div class="horizontal-swiper-scoller small">
					<div class="scroller-inner">
                        <?php
                        for($i=0;$i<count($best_item_array);$i++){
                            // 메인사진 구하기
                            $file_sql = "SELECT * FROM tb_file WHERE is_delete = '1' AND f_seq IN ({$best_item_array[$i]['product_img']}) LIMIT 1";
                            $file_result = sql_query($file_sql);
                            $file_row = sql_fetch($file_result);
                            $photo = ($file_row['file_path'])? "https://image.banjjakpet.com".img_link_change($file_row['file_path']) : $best_item_array[$i]['goodsRepImage'];

                            //할인율 구하기
                            $percent = ($best_item_array[$i]['product_price'] == 0 || $best_item_array[$i]['sale_price'] == 0)? 0 : 100 - ($best_item_array[$i]['sale_price'] / $best_item_array[$i]['product_price'] * 100);
                            ?>
                            <div class="scroller-item">
                                <a href="shop_view?product_no=<?=$best_item_array[$i]['product_no']?>" class="product-item">
                                    <div class="thumb"><div class="obj"><img src="<?= $photo?>"></div></div>
                                    <div class="info-wrap">
                                        <div class="item-name"><?=$best_item_array[$i]['product_name']?></div>
                                        <div class="item-price-group">
                                            <div class="price-sale"><?=round($percent)?>%</div>
                                            <div class="price-value"><?=number_format($best_item_array[$i]['sale_price'])?>원</div>
                                        </div>
                                        <div class="item-grade"><div class="icon icon-size-16 icon-star-yellow"></div><em><?=round($best_item_array[$i]['rating_avg'])?></em>(<?php echo ($best_item_array[$i]['rating_cnt']>0)?$best_item_array[$i]['rating_cnt']:0; ?>)</div>
                                    </div>
                                </a>
                            </div>
                            <?php
                        }
                        ?>
					</div>
				</div>
			</div>
			<div class="basic-data-group">
				<div class="con-title-group">
                    <h4 class="con-title"><span id="item_cnt"></span>개의 상품</h4>
				</div>				
				<div class="product-vertical-list">
					<div class="list-inner">
						<!-- <div class="list-cell">
							<a href="#" class="product-item">
								<div class="thumb"><div class="obj"><img src="/static/pub/images/product_thumb_1.png" alt=""><div class="label-soldout">품절</div></div></div>
								<div class="info-wrap">
									<div class="item-name">최대 두줄까지 표현됩니다. 최대 두줄까지 표현됩니다. 최대 두줄까지 표현됩니다. 최대 두줄까지 표현됩니다. 최대 두줄까지 표현됩니다.</div>
									<div class="item-price-group">
										<div class="price-sale">50%</div>
										<div class="price-value">33,000원</div>
									</div>
									<div class="item-grade"><div class="icon icon-size-16 icon-star-yellow"></div><em>5.0</em>(100+)</div>
								</div>
							</a>
						</div> -->
					</div>				
				</div>
			</div>
		</div>
	</div>
	<!-- //page-body -->	
	<div class="common-bottom-ui left">
		<a href="shop_cart" class="btn-page-cart"><em>0</em></a>
	</div>
	<div class="common-bottom-ui right">
		<button type="button" id="btnPageTop" class="btn-page-top" onclick="common.pageMove(0);">상단 바로가기</button>
	</div>
</section>
<!-- //container -->

<script>

    var seq = <?=$main_category?>; // 최초 상단 카테고리
    var middle_category = <?=$category?>;
    var limit = 0; // 스크롤 내릴때의 상품 노출 리미트
    var timer;
    $(document).ready(function(){
       click_tab(seq);
        click_category(middle_category);
        $(".page-body").on('scroll',function(){
            if (this.offsetHeight + this.scrollTop >= (this.scrollHeight - 200)) {
                if (!timer) {
                    timer = setTimeout(function() {
                        timer = null;
                        scroll_down(middle_category, limit);
                    }, 100);
                }
            }
        });

        // 장바구니 개수
            $.ajax({
                url: './data/item_ajax.php',
                data: {
                    mode: "get_cart_cnt",
                    customer_id: "<?=$user_id ?>"
                },
                type: 'POST',
                dataType: 'JSON',
                success: function(data){
                    $(".btn-page-cart em").text(data.data);
                }
            });
    });

    var category_group = 1;

    // 상위 카테고리 탭 클릭시
    function click_tab(category){
        $(".btn-tab-item").parent().removeClass("actived")
        $("#middle_category_"+category).parent().addClass("actived");

        $.ajax({
           url: './data/item_ajax.php',
           data: {
               mode: 'get_last_category',
               category: category
           },
           type: 'POST',
           dataType: 'JSON',
           success: function (data){
               var html = '';
               html += '<div class="swiper-container">';
               html += '    <div class="swiper-wrapper">';
               var length = data.data[0].length;
               var cnt = 0;

               // 한칸일때
               if(length <= 9) {

                   html += '<div class="swiper-slide">';
                   html += '    <div class="shop-category-menu-list">';
                   $.each(data.data[0], function (i, v) {
                       var checked = (v.ic_seq == middle_category)? 'actived' : '';
                       html += '        <a href="javascript:click_category('+v.ic_seq+',\''+v.cate_name+'\');" class="middle_category '+checked+'" data-id="'+v.ic_seq+'">'+v.cate_name+'</a>';
                   });
                   html += '    </div>';
                   html += '</div>';

               // 두칸일때
               }else if(length > 9 && length < 18){

                   html += '<div class="swiper-slide">';
                   html += '    <div class="shop-category-menu-list">';
                   for(var i=0;i<9;i++){
                       var checked = (data.data[0][i]['ic_seq'] == middle_category)? 'actived' : '';
                       html += '        <a href="javascript:click_category('+data.data[0][i]['ic_seq']+',\''+data.data[0][i]['cate_name']+'\');" class="middle_category '+checked+'" data-id="'+data.data[0][i]['ic_seq']+'">'+data.data[0][i]['cate_name']+'</a>';
                   }
                   html += '    </div>';
                   html += '</div>'

                   html += '<div class="swiper-slide">';
                   html += '    <div class="shop-category-menu-list">';
                   for(var i=9;i<length;i++){
                       html += '        <a href="javascript:click_category('+data.data[0][i]['ic_seq']+',\''+data.data[0][i]['cate_name']+'\');" class="middle_category" data-id="'+data.data[0][i]['ic_seq']+'">'+data.data[0][i]['cate_name']+'</a>';
                   }
                   html += '    </div>';
                   html += '</div>'

               // 세칸일때
               }else if(length > 18){

                   html += '<div class="swiper-slide">';
                   html += '    <div class="shop-category-menu-list">';
                   for(var i=0;i<9;i++){
                       var checked = (data.data[0][i]['ic_seq'] == middle_category)? 'actived' : '';
                       html += '        <a href="javascript:click_category('+data.data[0][i]['ic_seq']+',\''+data.data[0][i]['cate_name']+'\');" class="middle_category '+checked+'" data-id="'+data.data[0][i]['ic_seq']+'">'+data.data[0][i]['cate_name']+'</a>';
                   }
                   html += '    </div>';
                   html += '</div>'

                   html += '<div class="swiper-slide">';
                   html += '    <div class="shop-category-menu-list">';
                   for(var i=9;i<18;i++){
                       html += '        <a href="javascript:click_category('+data.data[0][i]['ic_seq']+',\''+data.data[0][i]['cate_name']+'\');" class="middle_category" data-id="'+data.data[0][i]['ic_seq']+'">'+data.data[0][i]['cate_name']+'</a>';
                   }
                   html += '    </div>';
                   html += '</div>'

                   html += '<div class="swiper-slide">';
                   html += '    <div class="shop-category-menu-list">';
                   for(var i=18;i<length;i++){
                       html += '        <a href="javascript:click_category('+data.data[0][i]['ic_seq']+',\''+data.data[0][i]['cate_name']+'\');" class="middle_category" data-id="'+data.data[0][i]['ic_seq']+'">'+data.data[0][i]['cate_name']+'</a>';
                   }
                   html += '    </div>';
                   html += '</div>'

               }
               html += '</div>';
               html += '    <div class="swiper-page"></div>';

               $(".shop-category-menu").html(html);
               var swiper_category = new Swiper('.swiper-container', {
                   slidesPerView: 'auto',
                   spaceBetween: 30,
                   loopAdditionalSlides : 1,
                   debugger: true,
                   loop: false,
                   // initialSlide: (category_group - 1),
                   pagination: {
                       el: '.swiper-page',
                       type: 'fraction',
                   },
                   observer: true,
               });


                console.log(category);
                console.log(data.data);
                console.log(data.data[0].length);

           },
            error: function(xhr, status, error) {
                //alert(error + "네트워크에러1");
                if(xhr.status != 0){
                    alert("code = "+ xhr.status + " message = " + xhr.responseText + " error = " + error); // 실패 시 처리
                }
            }

        });

    }

    // 내부 카테고리 클릭시
    function click_category(seq, name){
        limit = 0;
        $(".middle_category").removeClass("actived");
        $(".middle_category[data-id="+seq+"]").addClass("actived");
        $(".page-title").text(name);
        middle_category = seq;
        $.ajax({
           url: './data/item_ajax.php',
           data: {
               mode: 'get_item_list',
               category: seq,
               limit: limit
           },
           type: 'POST',
           dataType: 'JSON',
           success: function(data){
               console.log(data.cnt);
               if(data.code == '000000'){
                   $("#item_cnt").html(data.cnt);
                   var html = '';
                   $.each(data.data['item'], function(i,v){

                       var soldout = (v.is_soldout == '2')? '<div class="label-soldout">품절</div>' : ''; // 품절 표시
                       var percent = (v.product_price == 0 || v.sale_price == 0)? 0 : 100 - (v.sale_price / v.product_price * 100); // 할인율 구하기
                       var rating_avg = (v.rating_avg != '' && v.rating_avg)? v.rating_avg : 0; // 별점 평균
                       var rating_cnt = (v.rating_cnt != '' && v.rating_cnt)? v.rating_cnt : 0; // 후기 수

                       html += '<div class="list-cell">';
                       html += '    <a href="shop_view?product_no='+v.product_no+'" class="product-item">';
                       html += '        <div class="thumb"><div class="obj"><img src="'+data.data['photo'][i]+'" alt="">'+soldout+'</div></div>';
                       html += '        <div class="info-wrap">';
                       html += '            <div class="item-name">'+v.product_name+'</div>';
                       html += '            <div class="item-price-group">';
                       html += '                <div class="price-sale">'+Math.round(percent)+'%</div>';
                       html += '                <div class="price-value">'+v.sale_price.format()+'원</div>';
                       html += '            </div>';
                       html += '            <div class="item-grade"><div class="icon icon-size-16 icon-star-yellow"></div><em>'+Math.round(rating_avg)+'</em>('+rating_cnt+')</div>';
                       html += '        </div>';
                       html += '    </a>';
                       html += '</div>';
                   });
                   $(".list-inner").html(html);
                   limit = limit + 20;
               }else{
                   alert("error");
               }
           },
           error: function(xhr, status, error) {
               //alert(error + "네트워크에러1");
               if(xhr.status != 0){
                   alert("code = "+ xhr.status + " message = " + xhr.responseText + " error = " + error); // 실패 시 처리
               }
           }
        });
    }

    function scroll_down(seq, f_limit){
        console.log(seq, f_limit);
        $.ajax({
            url: './data/item_ajax.php',
            data: {
                mode: 'get_item_list',
                category: seq,
                limit: f_limit
            },
            type: 'POST',
            dataType: 'JSON',
            success: function(data){
                limit = limit + 20;
                console.log(limit);
                console.log(data.cnt);
                if(data.code == '000000'){
                    $("#item_cnt").html(data.cnt);
                    var html = '';
                    $.each(data.data['item'], function(i,v){

                        var soldout = (v.is_soldout == '2')? '<div class="label-soldout">품절</div>' : ''; // 품절 표시
                        var percent = (v.product_price == 0 || v.sale_price == 0)? 0 : 100 - (v.sale_price / v.product_price * 100); // 할인율 구하기
                        var rating_avg = (v.rating_avg != '' && v.rating_avg)? v.rating_avg : 0; // 별점 평균
                        var rating_cnt = (v.rating_cnt != '' && v.rating_cnt)? v.rating_cnt : 0; // 후기 수

                        html += '<div class="list-cell">';
                        html += '    <a href="shop_view?product_no='+v.product_no+'" class="product-item">';
                        html += '        <div class="thumb"><div class="obj"><img src="'+data.data['photo'][i]+'" alt="">'+soldout+'</div></div>';
                        html += '        <div class="info-wrap">';
                        html += '            <div class="item-name">'+v.product_name+'</div>';
                        html += '            <div class="item-price-group">';
                        html += '                <div class="price-sale">'+Math.round(percent)+'%</div>';
                        html += '                <div class="price-value">'+v.sale_price.format()+'원</div>';
                        html += '            </div>';
                        html += '            <div class="item-grade"><div class="icon icon-size-16 icon-star-yellow"></div><em>'+Math.round(rating_avg)+'</em>('+rating_cnt+')</div>';
                        html += '        </div>';
                        html += '    </a>';
                        html += '</div>';
                    });
                    $(".list-inner").append(html);
                }else{
                    alert("error");
                }
            },
            error: function(xhr, status, error) {
                //alert(error + "네트워크에러1");
                if(xhr.status != 0){
                    alert("code = "+ xhr.status + " message = " + xhr.responseText + " error = " + error); // 실패 시 처리
                }
            }
        });
    }

    // 세자리 숫자 콤마
    Number.prototype.format = function() {
        if (this == 0) return 0;

        var reg = /(^[+-]?\d+)(\d{3})/;
        var n = (this + '');

        while (reg.test(n)) n = n.replace(reg, '$1' + ',' + '$2');

        return n;
    };

    // 문자열 타입에서 쓸 수 있도록 format() 함수 추가
    String.prototype.format = function() {
        var num = parseFloat(this);
        if (isNaN(num)) return "0";

        return num.format();
    };
    let visitedAt = (new Date()).getTime();

    $('.app-download-link').on('click',function(){

        if(userAgent.match(/iphone|ipad|ipod/i)){

            setTimeout(
                function(){
                    if((new Date()).getTime() - visitedAt < 2000){
                        location.href = 'itms-apps://itunes.apple.com/kr/app/apple-store/id1436568194';
                    }
                }
                ,1500);

            setTimeout(
                function(){
                    location.href = 'banjjack://';
                }
                ,0);
        }else{

            setTimeout(
                function(){
                    if((new Date()).getTime() - visitedAt < 2000){
                        location.href = "https://play.google.com/store/apps/details?id=m.kr.gobeauty";
                    }



                }
                ,1500);

            setTimeout(
                function(){
                    location.href = "intent://shop_view#Intent;scheme=banjjack;package=m.kr.gobeauty;end";
                }
                ,0);
        }
    })
</script>

<?
//include($_SERVER['DOCUMENT_ROOT']."/include/skin/footer.php");
?>
