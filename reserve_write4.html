<?php
if( !class_exists('XenoPostToForm') ){
    class XenoPostToForm {
        public static function check() {
            return !isset($_COOKIE['PHPSESSID']) && count($_POST) && isset($_SERVER['HTTP_REFERER']) && !preg_match('~^https://'.preg_quote($_SERVER['HTTP_HOST'], '~').'/~', $_SERVER['HTTP_REFERER']);
        }

        public static function submit($posts) {
            echo '<html><head><meta charset="UTF-8"></head><body>';
            echo '<form id="f" name="f" method="post">';
            echo self::makeInputArray($posts);
            echo '</form>';
            echo '<script>';
            echo 'document.f.submit();';
            echo '</script></body></html>';
            exit;
        }

        public static function makeInputArray($posts) {
            $res = [];
            foreach($posts as $k => $v) {
                $res[] = self::makeInputArray_($k, $v);
            }
            return implode('', $res);
        }

        private static function makeInputArray_($k, $v) {
            if(is_array($v)) {
                $res = [];
                foreach($v as $i => $j) {
                    $res[] = self::makeInputArray_($k.'['.htmlspecialchars($i).']', $j);
                }
                return implode('', $res);
            }
            return '<input type="hidden" name="'.$k.'" value="'.htmlspecialchars($v).'" />';
        }
    }
}
if(XenoPostToForm::check()) XenoPostToForm::submit($_POST); // session_start(); 하기 전에
?>
<?
include($_SERVER['DOCUMENT_ROOT']."/include/global.php");
include($_SERVER['DOCUMENT_ROOT']."/include/check_login.php");
include($_SERVER['DOCUMENT_ROOT']."/include/skin/header.php");
include($_SERVER['DOCUMENT_ROOT']."/data/get_artist_id.php");

//jin 이거주석 풀면 App이 중복선언되있다고 나옴
//include($_SERVER['DOCUMENT_ROOT']."/include/App.class.php");

//jin 일단 주석처리
//$cl_result = include "../include/check_login.php";
//if ($cl_result == 0) {
//    return false;
//}

$crypto = new Crypto();
$is_android = 0;
$app = new App();
if ($app->is_app() == 1)
{
    $is_android = 1;
}

$user_agent = $_SERVER['HTTP_USER_AGENT'];
$is_ios = 0;
if ($user_agent)
{
    $token_index = strpos($user_agent, "APP_GOBEAUTY_iOS");
    if ($token_index > 0)
    {
        $is_ios = 1;
        $is_android = 1; //is_android 속성을 많이 사용하고 있어서 일단 Android앱으로 판단후 iOS로 구분한다.
    }
}

// 무통장 입금 두시간 뒤 시간 구하기
$now_date = date("Y년 m월 d일 H시 i분 s초");
//echo "<br><br><br>".$now_date;
$two_hours = date("Y년 m월 d일 H시 i분 s초", strtotime(strtotime($now_date)."+2 hours"));
//echo "<br>".$two_hours;
// 무통장입금 데이터
$expire_time = date("Y-m-d H:i:s", strtotime(strtotime($now_date)."+2 hours"));

$backurl = isset($_GET['backurl']) ? $_GET['backurl'] : "";
$artist_id = isset($_GET['artist_id']) ? $_GET['artist_id'] : "";
$pet_seq = isset($_GET['pet_seq']) ? $_GET['pet_seq'] : "";
$empty = isset($_SESSION['empty']) ? $_SESSION['empty'] : ""; // 빈시간판매하기 여부
$user_id = $_SESSION['gobeauty_user_id'];
$user_name = $_SESSION['gobeauty_user_nickname'];
//$_SESSION['reservation_artist_name'] = $artist_name;
$artist_name = get_artist_id(addslashes($artist_id));
$serviceResultArray = isset($_GET['serviceResultArray']) ? json_encode($_GET['serviceResultArray']) : "";
$etcResultArray = isset($_GET['etcResultArray']) ? json_encode($_GET['etcResultArray']) : "";
$timeResultArray = isset($_GET['timeResultArray']) ? json_encode($_GET['timeResultArray']) : "";

$order_id = str2hex($user_id)."_".rand_id();

// 빈시간 판매하기 정보
if($_SESSION['empty'] > 0) {
    $empty_sql = "SELECT * FROM tb_sale_free_time_mgr WHERE idx = '{$empty}'";
    $empty_result = mysqli_query($connection, $empty_sql);
    $empty_datas = mysqli_fetch_object($empty_result);
    $empty_type = $empty_datas->sale_kind;
    $empty_value = $empty_datas->kind_value;
    $empty_sale = ($empty_type == 1)? "원" : "%";
}

// 샵정보
$shop_sql = "
    SELECT * FROM tb_shop WHERE customer_id = '".$artist_id."'
";
$shop_result = mysqli_query($connection, $shop_sql);
$shop_datas = mysqli_fetch_object($shop_result);
$is_vat = $shop_datas->is_vat;
$is_setting_pay = $shop_datas->is_setting_pay_in_shop;

// 유저정보
$user_sql = "
    SELECT * FROM tb_customer WHERE id = '".$user_id."'
";
$user_result = mysqli_query($connection, $user_sql);
$user_datas = mysqli_fetch_object($user_result);
$user_cellphone = $crypto->decode(trim($user_datas->cellphone), $access_key, $secret_key);

// 펫 정보
$pet_sql = "
    SELECT * FROM tb_mypet WHERE pet_seq = '".$pet_seq."'
";
$pet_result = mysqli_query($connection, $pet_sql);
$pet_datas = mysqli_fetch_object($pet_result);
$pet_name = $pet_datas->name_for_owner;
$pet_type = $pet_datas->type;
$pet_birth = $pet_datas->year.".".$pet_datas->month.".".$pet_datas->day;
$pet_gender = $pet_datas->gender;
$pet_weight = $pet_datas->weight;
$pet_photo = "https://image.banjjakpet.com".img_link_change($pet_datas->photo);

$pet_product_name = $pet_datas->name;
$pet_product_type = "";
if($pet_datas->type == 'cat'){
    $pet_product_type = "고양이";
}else{
    $pet_product_type = "개";
}

// 회원 등급 확인
$sql1 = "
    SELECT a.idx, b.grade_ord FROM tb_grade_of_customer a
    INNER JOIN tb_grade_of_shop b ON a.grade_idx = b.idx
    WHERE a.customer_id = '".$user_id."'
    AND b.artist_id = '".$artist_id."'
";
$result1 = mysqli_query($connection, $sql1);
$datas = mysqli_fetch_object($result1);
$grade_ord = $datas->grade_ord;

// KG inicis 결제모듈

/*
// PC
require_once('/include/libs/INIStdPayUtil.php');
$SignatureUtil = new INIStdPayUtil();
//############################################
// 1.전문 필드 값 설정(***가맹점 개발수정***)
//############################################
// 여기에 설정된 값은 Form 필드에 동일한 값으로 설정
$mid = "banjjak001";  // 가맹점 ID(가맹점 수정후 고정) / 테스트 INIpayTest
//인증
$signKey = "WEZJN0NGWW44K1Z3WitTdjVIWVNIZz09"; // 가맹점에 제공된 웹 표준 사인키(가맹점 수정후 고정) / 테스트 SU5JTElURV9UUklQTEVERVNfS0VZU1RS
$timestamp = $SignatureUtil->getTimestamp();   // util에 의해서 자동생성

//$orderNumber = $mid . "_" . $SignatureUtil->getTimestamp(); // 가맹점 주문번호(가맹점에서 직접 설정)
$orderNumber = substr($order_id, 0, 40); // order_id 의 글자 제한수가 40자 이하라서 order_id의 앞부분만 전달 후 비교
$price = ($_SESSION['gobeauty_cart_spend_point'] > 0)? round($_SESSION["gobeauty_total_price"] - $_SESSION['gobeauty_cart_spend_point']) : $_SESSION["gobeauty_total_price"];// 상품가격(특수기호 제외, 가맹점에서 직접 설정) //$_SESSION["gobeauty_total_price"];

$cardNoInterestQuota = "";  // 카드 무이자 여부 설정(가맹점에서 직접 설정)
$cardQuotaBase = "";  // 가맹점에서 사용할 할부 개월수 설정

//###################################
// 2. 가맹점 확인을 위한 signKey를 해시값으로 변경 (SHA-256방식 사용)
//###################################
$mKey = $SignatureUtil->makeHash($signKey, "sha256");

$params = array(
    "oid" => $orderNumber,
    "price" => $price,
    "timestamp" => $timestamp
);
$sign = $SignatureUtil->makeSignature($params, "sha256");

// 기타
$siteDomain = "https://www.gopet.kr/pet"; //가맹점 도메인 입력 (*pc 적용할때 바꾸면 됨)
*/


// Mobile
//$INI_shopNumber = ""; // 발급ID - 실거래
$INI_shopNumber = "banjjak001"; // 발급ID - 테스트
$INI_host = "mobile.inicis.com";
$INI_url = array(
    "card"		=> "https://".$INI_host."/smart/payment/",	// 신용카드
    "bank"		=> "https://".$INI_host."/smart/payment/",	// 계좌이체
    "vbank"		=> "https://".$INI_host."/smart/payment/",	// 가상계좌
    "moblie"	=> "https://".$INI_host."/smart/payment/",	// 휴대폰
    "culture"	=> "https://".$INI_host."/smart/culture/",	// 문화상품권
    "hpmn"		=> "https://".$INI_host."/smart/hpmn/",		// 해피머니상품권
    "dgcl"		=> "https://".$INI_host."/smart/dgcl/"		// 스마트문상
);

?>
<!-- 상용 JS(가맹점 MID 변경 시 주석 해제, 테스트용 JS 주석 처리 필수!) -->
<script language="javascript" type="text/javascript" src="https://stdpay.inicis.com/stdjs/INIStdPay.js" charset="UTF-8"></script>

<!-- 테스트 JS(샘플에 제공된 테스트 MID 전용) -->
<!--script language="javascript" type="text/javascript" src="https://stgstdpay.inicis.com/stdjs/INIStdPay.js" charset="UTF-8"></script-->

<!-- header -->
<!--reserve_write3?artist_id=--><?//=$artist_id?><!--&pet_seq=--><?//=$pet_seq?><!--&timeResultArray=--><?//=$timeResultArray?><!--&serviceResultArray=--><?//=$serviceResultArray?><!--&etcResultArray=--><?//=$etcResultArray?>
<header id="header">
    <div class="header-left">
        <a href="javascript:history.back();" class="btn-page-ui btn-page-prev"><div class="icon icon-size-24 icon-page-prev">페이지 뒤로가기</div></a>
    </div>
    <div class="page-title">예약 신청하기</div>
    <div class="reserve-state-bar">
        <div class="bar" style="width:66.66%"></div>
    </div>
</header>
<!-- //header -->
<style>
    .receipt-buy-detail .item-data-list .list-cell{display: none;}
</style>
<!-- container -->
<section id="container">
    <!-- page-body -->
    <div class="page-body">
        <!-- page-contents -->
        <div class="page-contents">
            <div class="reserve-request-wrap">
                <div class="basic-data-group">
                    <div class="customer-card-item type2">
                        <h5 class="con-title">신청자 정보</h5>
                        <div class="item-info-wrap">
                            <div class="item-thumb">
                                <div class="user-thumb middle">
                                    <?if($pet_photo != ''){?>
                                        <img src="<?=$pet_photo?>" alt="">
                                    <?}else{?>
<!--                                        <img src="/static/pub/images/user_thumb.png" alt="">-->
                                    <?}?>
<!--                                    <img src="--><?//=$pet_photo?><!--">-->
                                </div>
                            </div>
                            <div class="item-data">
                                <div class="item-data-inner">
                                    <div class="item-pet-name"><?=$pet_name?></div>
                                    <div class="item-pet-date"><?=$pet_birth?> 출생 <!--(8년 9개월)--></div>
                                    <div class="item-pet-body"><?=$pet_gender?> / <?=$pet_weight?>kg</div>
                                </div>
                            </div>
                        </div>
                        <!--
                        <div class="item-modify">
                            <div class="form-control-btns">
                                <div class="form-label-input">
                                    <label>연락처</label>
                                    <div class="form-txt"><?=$user_cellphone?></div>
                                </div>
                                <button type="button" class="btn btn-outline-purple btn-inline btn-round" onclick="pop.open('payPhoneModify');">변경</button>
                            </div>
                        </div>
                        -->
                    </div>
                </div>
                <div class="basic-data-group">
                    <div class="user-receipt-item">
                        <h5 class="con-title">예약 펫샵 및 일시</h5>
                        <div class="simple-thumb-info">
                            <div class="thumb-wrap">
                                <div class="content-thumb small">
                                    <?if($shop_datas->front_image != ''){?>
                                        <img src="<?="https://image.banjjakpet.com".img_link_change($shop_datas->front_image)?>" alt="">
                                    <?}else{?>
<!--                                        <img src="/static/pub/images/user_thumb.png" alt="">-->
                                    <?}?>
                                </div>
                            </div>
                            <div class="info-wrap">
                                <div class="info-inner">
                                    <div class="item-title"><?=$shop_datas->name?></div>
                                    <div class="item-date" id="beauty_date"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="basic-data-group">
                    <div class="user-receipt-item">
                        <h5 class="con-title">예약 내용</h5>
                        <div class="receipt-buy-detail">
                            <div class="item-data-list">
                                <div class="list-cell" id="main_service_1_cell">
                                    <div class="list-title" id="main_service_1">소형견미용/목욕/~3Kg</div>
                                    <div class="list-value" id="main_service_1_price">20,000원</div>
                                </div>
                                <div class="list-cell" id="main_service_2_cell">
                                    <div class="list-title" id="main_service_2"></div>
                                    <div class="list-value" id="main_service_2_price"></div>
                                </div>
                                <div class="list-cell" id="main_service_3_cell">
                                    <div class="list-title" id="main_service_3"></div>
                                    <div class="list-value" id="main_service_3_price"></div>
                                </div>
                                <div class="list-cell" id="etc_service_1_cell">
                                    <div class="list-title" id="etc_service_1"></div>
                                    <div class="list-value" id="etc_service_1_price"></div>
                                </div>
                                <div class="list-cell" id="etc_service_2_cell">
                                    <div class="list-title" id="etc_service_2"></div>
                                    <div class="list-value" id="etc_service_2_price"></div>
                                </div>
                                <div class="list-cell" id="etc_service_3_cell">
                                    <div class="list-title" id="etc_service_3"></div>
                                    <div class="list-value" id="etc_service_3_price"></div>
                                </div>
                                <div class="list-cell" id="etc_service_4_cell">
                                    <div class="list-title" id="etc_service_4"></div>
                                    <div class="list-value" id="etc_service_4_price"></div>
                                </div>
                            </div>
                        </div>
                        <div class="receipt-buy-detail total-price">
                            <div class="item-data-list">
                                <div class="list-cell" id="total_price_cell">
                                    <div class="list-title"><strong>합산 금액</strong></div>
                                    <div class="list-value"><strong id="total_price"></strong></div>
                                </div>
                                <div class="list-cell" id="vat_price_cell">
                                    <div class="list-title"><strong>부가세 10%</strong></div>
                                    <div class="list-value"><strong id="vat_price"></strong></div>
                                </div>
                                <?php
                                if($_SESSION['empty'] > 0){
                                    ?>
                                    <div class="list-cell" id="empty" style="display: flex;">
                                        <div class="list-title"><strong>할 인</strong></div>
                                        <div class="list-value"><strong id="emtpy"><?php echo $empty_value.$empty_sale;?></strong></div>
                                    </div>
                                    <?php
                                }
                                ?>
                            </div>
                        </div>
                        <div class="receipt-buy-detail result-price">
                            <div class="item-data-list">
                                <div class="list-cell" id="result_price_cell">
                                    <?php
                                    if($grade_ord != 1){
                                        ?><div class="list-title font-color-purple"><strong>총 결제 예상 금액</strong></div><?php
                                    }else{
                                        ?><div class="list-title font-color-purple"><strong>총 결제 합산 금액</strong></div><?php
                                    }
                                    ?>
                                    <div class="list-value font-color-purple"><strong id="result_price"></strong></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 20220308 수정 -->
                <div class="basic-data-group">
                    <div class="con-title-group">
                        <h5 class="con-title">결제방법</h5>
                    </div>
                    <div class="wide-tab card">
                        <div class="wide-tab-inner">
                            <!-- 활성화시 actived클래스 추가 -->
                            <!-- 비활성화시 disabled클래스 추가 -->
                            <?php
                            if($is_setting_pay == 0){ // 지금 결제만 가능
                                ?>
                                <div class="tab-cell disabled" id="payment_shop_tab"><button type="button" class="btn-tab-item" disabled>매장결제</button></div>
                                <?php
                                if($grade_ord != 1){
                                    ?><div class="tab-cell disabled"><button type="button" class="btn-tab-item" disabled>지금결제</button></div><?php
                                }else{
                                    ?><div class="tab-cell actived" id="payment_now_tab" onclick="clickPayment('now')"><button type="button" class="btn-tab-item">지금결제</button></div><?php
                                }
                            }else if($is_setting_pay == 1){ // 둘다 가능
                                ?>
                                <div class="tab-cell actived" id="payment_shop_tab" onclick="clickPayment('shop')"><button type="button" class="btn-tab-item">매장결제</button></div>
                                <?php
                                if($grade_ord != 1){
                                    ?><div class="tab-cell disabled"><button type="button" class="btn-tab-item" disabled>지금결제</button></div><?php
                                }else{
                                    ?><div class="tab-cell disabled" id="payment_now_tab" onclick="clickPayment('now')"><button type="button" class="btn-tab-item">지금결제</button></div><?php
                                }
                            }else if($is_setting_pay == 2){ // 매장결제만 가능
                                ?>
                                <div class="tab-cell actived" id="payment_shop_tab" onclick="clickPayment('shop')"><button type="button" class="btn-tab-item">매장결제</button></div>
                                <div class="tab-cell disabled"><button type="button" class="btn-tab-item" disabled>지금결제</button></div>
                                <?php
                            }
                            ?>
                        </div>
                    </div>
                    <div class="basic-data-group vvsmall3">
                        <div class="tab-data-group">
                            <!-- tab-data-cell 클래스에 actived클래스 추가시 활성화 -->
                            <!-- 매장결제 -->
                            <div class="tab-data-cell actived" id="payment_shop">
                                <div class="user-receipt-item">
                                    <div class="pay-card-group border-none top">
                                        <div class="pay-card-cell all"><label class="form-checkbox"><input type="checkbox" class="checkAll_shop"/><span class="form-check-icon"><em><strong>전체선택</strong></em></span></label></div>
                                        <div class="pay-card-cell"><label class="form-checkbox"><input type="checkbox" name="payCard" class="check_1_shop"/><span class="form-check-icon"><em>(필수) 몸무게, 털엉킴, 사나움, 진드기 등은 현장판단 후 추가 요금이 발생하거나 미용이 중단/거부될 수 있음에 동의합니다.</em></span></label></div>
                                        <div class="pay-card-cell"><label class="form-checkbox"><input type="checkbox" name="payCard" class="check_2_shop"/><span class="form-check-icon"><em>(필수) 예방접종 4회 이상 완료하였습니다.</em></span></label></div>
                                        <div class="pay-card-cell"><label class="form-checkbox"><input type="checkbox" name="payCard" class="check_3_shop"/><span class="form-check-icon"><em>(필수) 노령견, 장시간 서있지 못하는 아이(슬개골 관절 질환), 피부질환이 심한 아이는 미용이 불가할 수 있음에 동의합니다.</em></span></label></div>
                                        <div class="pay-card-cell rule">
                                            <div class="pay-card-rule-wrap">
                                                <div class="pay-card-check">
                                                    <label class="form-checkbox"><input type="checkbox" name="payCard" class="check_4_shop"/><span class="form-check-icon"><em>(필수) 구매내용과 예약취소 규정을 확인하였습니다.</em></span></label>
                                                    <button type="button" class="btn-pay-card-toggle"></button>
                                                </div>
                                                <div class="pay-card-rule">
                                                    <div class="info">* 예약 취소 규정</div>
                                                    <div class="rule-table">
                                                        <table>
                                                            <colgroup>
                                                                <col style="width:40%">
                                                                <col style="width:60%">
                                                            </colgroup>
                                                            <thead>
                                                            <tr>
                                                                <th>취소기준일</th>
                                                                <th>취소수수료</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr>
                                                                <td>예약 1일전까지</td>
                                                                <td>없음<br>(단, 계좌이체로 결제한 경우 결제 취소수수료가 발생할 수 있음)</td>
                                                            </tr>
                                                            <tr>
                                                                <td>예약당일</td>
                                                                <td>50%<br>(단, 결제 당일 바로취소는 취소수수료 없이 취소가능하나 2시간 전까지만 가능합니다.)</td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- //매장결제 -->
                            <!-- 지금결제 -->
                            <div class="tab-data-cell" id="payment_now">
                                <div class="user-receipt-item">
                                    <h5 class="con-title">결제수단</h5>
                                    <div class="form-check-group">
                                        <div class="form-check-inner">
                                            <div class="check-cell"><label for="pay1" class="form-radiobox"><input type="radio" id="pay1" name="pay" value="pay1" checked><span class="form-check-icon"><em>신용/체크카드</em></span></label></div>
                                            <div class="check-cell"><label for="pay2" class="form-radiobox"><input type="radio" id="pay2" name="pay" value="pay2"><span class="form-check-icon"><em>무통장입금</em></span></label></div>
                                        </div>
                                    </div>
                                    <div class="pay-group">
                                        <!-- 신용/체크카드 -->
                                        <div class="pay-group-cell" style="display:block;">
                                            <div class="pay-card-group">
                                                <div class="pay-card-cell all"><label class="form-checkbox"><input type="checkbox" class="checkAll_now"/><span class="form-check-icon"><em><strong>전체선택</strong></em></span></label></div>
                                                <!-- 20211223 수정 -->
                                                <div class="pay-card-cell"><label class="form-checkbox"><input type="checkbox" name="payCard" class="check_1_now"/><span class="form-check-icon"><em>(필수) 몸무게, 털엉킴, 사나움, 진드기 등은 현장판단 후 추가 요금이 발생하거나 미용이 중단/거부될 수 있음에 동의합니다.</em></span></label></div>
                                                <!-- //20211223 수정 -->
                                                <div class="pay-card-cell"><label class="form-checkbox"><input type="checkbox" name="payCard" class="check_2_now"/><span class="form-check-icon"><em>(필수) 예방접종 4회 이상 완료하였습니다.</em></span></label></div>
                                                <div class="pay-card-cell"><label class="form-checkbox"><input type="checkbox" name="payCard" class="check_3_now"/><span class="form-check-icon"><em>(필수) 노령견, 장시간 서있지 못하는 아이(슬개골 관절 질환), 피부질환이 심한 아이는 미용이 불가할 수 있음에 동의합니다.</em></span></label></div>
                                                <div class="pay-card-cell rule">
                                                    <div class="pay-card-rule-wrap">
                                                        <div class="pay-card-check">
                                                            <label class="form-checkbox"><input type="checkbox" name="payCard" class="check_4_now"/><span class="form-check-icon"><em>(필수) 구매내용과 예약취소 규정을 확인하였습니다.</em></span></label>
                                                            <button type="button" class="btn-pay-card-toggle"></button>
                                                        </div>
                                                        <div class="pay-card-rule">
                                                            <div class="info">* 예약 취소 규정</div>
                                                            <div class="rule-table">
                                                                <table>
                                                                    <colgroup>
                                                                        <col style="width:40%">
                                                                        <col style="width:60%">
                                                                    </colgroup>
                                                                    <thead>
                                                                    <tr>
                                                                        <th>취소기준일</th>
                                                                        <th>취소수수료</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    <tr>
                                                                        <td>예약 1일전까지</td>
                                                                        <td>없음<br>(단, 계좌이체로 결제한 경우 결제 취소수수료가 발생할 수 있음)</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>예약당일</td>
                                                                        <td>50%<br>(단, 결제 당일 바로취소는 취소수수료 없이 취소가능하나 2시간 전까지만 가능합니다.)</td>
                                                                    </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- //신용/체크카드 -->
                                        <!-- 무통장입금 -->
                                        <div class="pay-group-cell" id="bank_payment" style="display:none;">
                                            <div class="pay-bank-group">
                                                <div class="pay-bank-name">기업은행 054-143076-01-013<br>주식회사 펫이지</div>
                                                <div class="form-group">
                                                    <div class="form-group-cell">
                                                        <div class="form-group-item">
                                                            <div class="form-item-label">입금자 성명</div>
                                                            <div class="form-item-data">
                                                                <input type="text" placeholder="이름을 입력해 주세요" id="bank_name" class="form-control"/>
                                                                <div class="form-input-info">*계좌이체 시 반드시 입력해 주세요.</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="pay-bank-info">
                                                    <div class="txt"><strong class="font-color-red"><?=$two_hours?></strong></div>
                                                    <div class="txt">*입금기한이 지나면 예약이 자동취소되니 유의해 주시기 바랍니다.</div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- //무통장입금 -->
                                    </div>
                                </div>
                            </div>
                            <!-- //지금결제 -->
                        </div>
                    </div>
                </div>
                <!-- //20220308 수정 -->
            </div>

        </div>
        <!-- //page-contents -->
    </div>
    <!-- //page-body -->
    <!--  예약자 연락처 변경하기 -->
    <!--
    <article id="payPhoneModify" class="layer-pop-wrap">
        <div class="layer-pop-parent">
            <div class="layer-pop-children">

                <div class="pop-data alert-pop-data">
                    <div class="pop-body">
                        <div class="msg-title">예약자 연락처 변경하기</div>
                        <div class="msg-txt">신청자와 예약자가 다른 경우거나, 다른 전화번호로 연락이 오길 원하시면 아래에 연락처를 입력해주세요.</div>
                        <div class="form-group">
                            <div class="form-group-cell">
                                <div class="form-group-item">
                                    <div class="form-item-label">연락처</div>
                                    <div class="form-item-data type-2">
                                        <input type="text" class="" placeholder="변경할 연락처를 입력해 주세요." value="작업중 by glory">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pop-footer">
                        <button type="button" class="btn btn-confirm" onclick="pop.close();">확인</button>
                        <button type="button" class="btn btn-confirm" onclick="">변경하기</button>
                    </div>
                </div>

            </div>
        </div>
    </article>
    -->
    <!-- //예약자 연락처 변경하기 -->
    <!-- page-bottom -->
    <div class="page-bottom">
        <!--
        //	비활성화시
        // - a태그는 disabled 클래스 추가
        // - button 태그는 disabled 속성 추가
        -->
        <a href="#" class="btn-page-bottom disabled" id="submit_reserve" onclick="submit_reserve()">
            <?php
            if($grade_ord != 1){
                ?>예약을 승인을 요청합니다.<?php
            }else{
                ?>예약을 신청합니다.<?php
            }
            ?>
        </a>
    </div>
    <!-- //page-bottom -->
</section>
<!-- //container -->

<!-- 카드결제 위한 form -->
<form id="INIpay_form" method="POST" action="<?=$INI_url['card']; ?>" accept-charset="euc-kr" onsubmit="emulAcceptCharset(this)">
    <input type="hidden" name="P_INI_PAYMENT" value="card" placeholder="결제요청 지불수단" />
    <input type="hidden" name="P_MID" value="<?=$INI_shopNumber ?>" placeholder="상점아이디" />
    <input type="hidden" name="P_OID" value="<?=$order_id?>" placeholder="주문번호" />
    <input type="hidden" name="P_AMT" id="inicis_result_price" value="" placeholder="거래금액" />
    <input type="hidden" name="P_UNAME" value="<?=$user_datas->nickname?>" placeholder="고객성명" />
    <input type="hidden" name="P_MNAME" value="<?=$shop_datas->name?>" placeholder="가맹점 이름" />
    <input type="hidden" name="P_NOTI" value="beauty" placeholder="기타주문정보(전달값그대로반환)" />
    <input type="hidden" name="P_GOODS" value="<?=$shop_datas->name?>" placeholder="결제상품명" /> <!-- 매장명-->
    <input type="hidden" name="P_MOBILE" value="<?=$user_cellphone?>" placeholder="구매자 휴대폰번호" />
    <input type="hidden" name="P_EMAIL" value="<?=$user_id?>" placeholder="구매자 이메일" />
    <input type="hidden" name="P_NEXT_URL" value="https://customer.banjjakpet.com/mainpage/INI_return.php?PHPSESSID=<?=$_COOKIE["PHPSESSID"]?>" placeholder="인증결과수신 URL" />
    <input type="hidden" name="P_NOTI_URL" value="https://customer.banjjakpet.com/mainpage/INI_result" placeholder="승인결과통보 URL" />
    <!--input type="hidden" name="P_TAX" value="" placeholder="부가세" /-->
    <!--input type="hidden" name="P_TAXFREE" value="" placeholder="비과세" /-->
    <input type="hidden" name="P_OFFER_PERIOD" value="별도 제공 기간 없음" placeholder="제공기간" />
    <!-- 신용카드 전용 필드 -->
    <input type="hidden" name="P_CARD_OPTION" value="" placeholder="신용카드 우선선택 옵션" />
    <input type="hidden" name="P_ONLY_CARDCODE" value="" placeholder="신용카드 노출제한 옵션" />
    <input type="hidden" name="P_QUOTABASE" value="" placeholder="신용카드 할부기간 지정" />
    <!-- 기타 옵션 필드 -->
    <input type="hidden" name="P_CHARSET" value="utf8" placeholder="케릭터셋 설정" />
    <!-- 복합필드(&으로 구분), 2020-10-14 아이폰 결제용으로 app_scheme=banjjack 추가 -->
    <?php if($token_index > 0){ // iOS ?>
        <input type="hidden" name="P_RESERVED" value="vbank_receipt=N&bank_receipt=N&cp_yn=N&app_scheme=banjjack://" placeholder="vbank_receipt=N&bank_receipt=N&cp_yn=N&app_scheme=banjjack://" />
    <?php }else{ ?>
        <input type="hidden" name="P_RESERVED" value="vbank_receipt=N&bank_receipt=N&cp_yn=N&" placeholder="vbank_receipt=N&bank_receipt=N&cp_yn=N&" />
    <?php } ?>
</form>
<!-- //카드결제 위한 form -->
<script>

    var pet_type = "<?=$pet_type?>";
    var empty_session = "<?=$_SESSION['empty']?>";

    var payment_type = 0; // 0:매장결제, 1:지금결제

    // 데이터 꺼내보기
    var serviceResultArray = JSON.parse(<?=$serviceResultArray?>);
    var etcResultArray = JSON.parse(<?=$etcResultArray?>);
    var timeResultArray = JSON.parse(<?=$timeResultArray?>);
    console.log(serviceResultArray);
    console.log(etcResultArray);
    console.log(timeResultArray);

    //var test_url = "https://customer.banjjakpet.com/mainpage/INI_return?PHPSESSID=<?//=$_COOKIE["PHPSESSID"]?>//";
    //test_url += '&artist_id=<?//=$artist_id?>//&pet_seq=<?//=$pet_seq?>//&timeResultArray='+JSON.stringify(timeResultArray)+'&serviceResultArray='+JSON.stringify(serviceResultArray)+'&etcResultArray='+JSON.stringify(etcResultArray);
    //$("input[name=P_NEXT_URL").val(test_url);

    var product_service = (serviceResultArray[1].name).replace(" ","+");

    var product_weight = (serviceResultArray[2].name != "")? (serviceResultArray[2].name).replace(/[^0-9.]/g, "")+":"+serviceResultArray[2].price : "";
    var product_mm = (serviceResultArray[4].name != "")? (serviceResultArray[4].name).replace(/[^0-9]/g, "")+":"+serviceResultArray[4].price : "";
    var product_face = (etcResultArray[0].name != "")? (etcResultArray[0].name)+":"+etcResultArray[0].price : "";
    var product_hair = (serviceResultArray[3].name != "")? serviceResultArray[3].name+":"+serviceResultArray[3].price : "";
    var product_foot_toenail = (etcResultArray[1].name == "발톱")? etcResultArray[1].price : "";
    var product_foot_trumpet = (etcResultArray[1].name == "장화")? etcResultArray[1].price : "";
    var product_foot_bell = (etcResultArray[1].name == "방울")? etcResultArray[1].price : "";
    var product_foot_etc = (etcResultArray[1].name != "발톱" && etcResultArray[1].name != "장화" && etcResultArray[1].name != "방울")? "1|"+etcResultArray[1].name+":"+etcResultArray[1].price : "0";
    var product_spa = (etcResultArray[2].name != "")? "1|"+etcResultArray[2].name+":"+etcResultArray[2].price : "0";
    var product_hair_color = (etcResultArray[3].name != "")? "1|"+etcResultArray[3].name+":"+etcResultArray[3].price : "0";


    // product 구하기
    var product = "<?=$pet_product_name?>|<?=$pet_product_type?>|<?=$artist_name?>|"+serviceResultArray[0].name+"|"+product_service+"|"+product_weight+"|"+product_face+"|"+product_mm+"|"+product_hair+"|"+product_foot_toenail+"|"+product_foot_trumpet+"|"+product_foot_bell+"|||"+product_foot_etc+"|"+product_spa+"|"+product_hair_color+"|0|0|0";

    console.log(product);


    // $(document).ready(function (){

        // 미용종료시간 구하기
        var start_time = timeResultArray[0].time;
        var start_time_min = (start_time.split(':')[1] == '30')? '50' : '00';
        start_time = start_time.split(':')[0]+start_time_min;
        //start_time = start_time.replace(':','');
        console.log(start_time);
        var beauty_time = (pet_type == 'dog')? serviceResultArray[1].price : 30;
        for(var i=0;i<beauty_time/30;i++){
            start_time = parseInt(start_time)+50;
        }
        var end_minute = start_time.toString().slice(-2);
        var end_hour = start_time.toString().replace(end_minute,'');
        if(end_minute == '50'){
            end_minute = '30';
        }else{
            end_minute = '00';
        }
        var end_time = end_hour+":"+end_minute;

        // 요일 구하기
        var week_txt = ['일', '월', '화', '수', '목', '금', '토'];
        var week_num = new Date(timeResultArray[0].date).getDay();
        var week = week_txt[week_num];

        // 날짜 포멧 바꾸기
        var beauty_day = timeResultArray[0].date.replace(/-/g,".");
        $("#beauty_date").html(beauty_day + " (" + week +") " + timeResultArray[0].time + "~" + end_time);

        // 연 월 일 구하기 결제시 컬럼에 들어갈 정보 쪼개기기
        var year = new Date(timeResultArray[0].date).getFullYear();
        var month = new Date(timeResultArray[0].date).getMonth()+1;
        var day = new Date(timeResultArray[0].date).getDate();
        var start_minute = (timeResultArray[0].time.replace(':','')).slice(-2);
        var start_hour = (timeResultArray[0].time.replace(':','')).replace(start_minute,'');
        console.log(year,month,day, start_hour,start_minute);

        // 상세 상품정보 넣기
        var main_service_1 = serviceResultArray[0].name + "/" + serviceResultArray[1].name + "/" + serviceResultArray[2].name;
        var main_service_1_price = serviceResultArray[2].price + "원";
        var main_service_2 = serviceResultArray[3].name;
        var main_service_2_price = serviceResultArray[3].price + "원";
        var main_service_3 = serviceResultArray[4].name;
        var main_service_3_price = serviceResultArray[4].price + "원";

        var etc_service_1 = etcResultArray[0].name;
        var etc_service_1_price = etcResultArray[0].price + "원";
        var etc_service_2 = etcResultArray[1].name;
        var etc_service_2_price = etcResultArray[1].price + "원";
        var etc_service_3 = etcResultArray[2].name;
        var etc_service_3_price = etcResultArray[2].price + "원";
        var etc_service_4 = etcResultArray[3].name;
        var etc_service_4_price = etcResultArray[3].price + "원";

        if(main_service_1 != ''){
            $("#main_service_1").html(main_service_1);
            $("#main_service_1_price").html(main_service_1_price);
            $("#main_service_1_cell").css("display","flex");
        }
        if(main_service_2 != ''){
            $("#main_service_2").html(main_service_2);
            $("#main_service_2_price").html(main_service_2_price);
            $("#main_service_2_cell").css("display","flex");
        }
        if(main_service_3 != ''){
            $("#main_service_3").html(main_service_3);
            $("#main_service_3_price").html(main_service_3_price);
            $("#main_service_3_cell").css("display","flex");
        }

        if(etc_service_1 != ''){
            $("#etc_service_1").html(etc_service_1);
            $("#etc_service_1_price").html(etc_service_1_price);
            $("#etc_service_1_cell").css("display","flex");
        }
        if(etc_service_2 != ''){
            $("#etc_service_2").html(etc_service_2);
            $("#etc_service_2_price").html(etc_service_2_price);
            $("#etc_service_2_cell").css("display","flex");
        }
        if(etc_service_3 != ''){
            $("#etc_service_3").html(etc_service_3);
            $("#etc_service_3_price").html(etc_service_3_price);
            $("#etc_service_3_cell").css("display","flex");
        }
        if(etc_service_4 != ''){
            $("#etc_service_4").html(etc_service_4);
            $("#etc_service_4_price").html(etc_service_4_price);
            $("#etc_service_4_cell").css("display","flex");
        }

        // 총 금액 구하기
        var total_price = serviceResultArray[2].price + serviceResultArray[3].price + serviceResultArray[4].price
                        + etcResultArray[0].price + etcResultArray[1].price + etcResultArray[2].price + etcResultArray[3].price;
        var is_vat = ("<?=$is_vat?>" == '1')? 1 : 0;
        var vat_price = 0;
        if(is_vat == 1){
            vat_price = total_price*0.1;
            $("#vat_price").html(vat_price+"원");
            $("#vat_price_cell").css("display","flex");
        }
        console.log(vat_price);
        var result_price = total_price + vat_price;
        if(empty_session > 0){ // 빈시간판매하기일때
            var empty_type = "<?=$empty_type?>";
            var empty_value = "<?=$empty_value?>";
            if(empty_type == 1){
                result_price = result_price - empty_value;
            }else{
                result_price = result_price * ((100-empty_value)/100);
            }
        }
        if(total_price > 0){
            $("#total_price").html(total_price+"원");
            $("#result_price").html(result_price+"원");
            $("#total_price_cell").css("display","flex");
            $("#result_price_cell").css("display","flex");

            $("#inicis_result_price").val(result_price);

        }
    // });

    $(document).ready(function(){
       if(<?=$is_setting_pay?> == 0){
           if(<?=$grade_ord?> == 1){
               $("#payment_shop_tab").removeClass("actived");
               $("#payment_shop").removeClass("actived");
               $("#payment_now").removeClass("disabled");

               $("#payment_now_tab").addClass("actived");
               $("#payment_shop").addClass("disabled");
               $("#payment_now").addClass("actived");
           }else{
               $("#payment_shop_tab").removeClass("actived");
               $("#payment_shop").removeClass("actived");
               $("#payment_now").removeClass("actived");

               $("#payment_now_tab").addClass("disabled");
               $("#payment_shop").addClass("disabled");
               $("#payment_now").addClass("disabled");
           }
       }
    });

    function clickPayment(type){
        if(type == 'now'){
            $("#payment_shop_tab").removeClass("actived");
            $("#payment_shop").removeClass("actived");
            $("#payment_now").removeClass("disabled");

            $("#payment_now_tab").addClass("actived");
            $("#payment_shop").addClass("disabled");
            $("#payment_now").addClass("actived");

            payment_type = 1;
        }else if(type == 'shop'){
            $("#payment_now_tab").removeClass("actived");
            $("#payment_now").removeClass("actived");
            $("#payment_shop").removeClass("disabled");

            $("#payment_shop_tab").addClass("actived");
            $("#payment_now").addClass("disabled");
            $("#payment_shop").addClass("actived");

            payment_type = 0;
        }
    }

    // 예약 신청하기
    function submit_reserve(){
        if($("input:checkbox[name=payCard]:checked").length < 8){
            alert("필수항목을 선택해주세요.");
            return false;
        }
        if(payment_type == 1){ // 지금결제일때
            if($("input:radio[name=pay]:checked").length <1){
                alert("결제수단을 선택해주세요.");
                return false;
            }
            if($("input:radio[name=pay]:checked").val() == "pay2"){ // 무통장 입금일때
                if($("#bank_name").val() == "" || !$("#bank_name").val()){
                    alert("입금자명을 입력해주세요.");
                    return false;
                }
                do_payment("bank");
                // paymentNowBank(); // 무통장입금 결제
            }else{ // 카드결제일때
                do_payment("card");
                // paymentNowCard(); // 카드결제
            }
        }else{ // 매장결제일때
            do_payment("shop");
            // paymentShop(); // 매장결제
        }
        // console.log("payment_type= "+payment_type, "pay_type= "+$("input:radio[name=pay]:checked").val(), "bank_name= "+$("#bank_name").val());

    }

    // 결제 모듈
    // 무통장입금 -> paymentNowBank()
    // 카드결제  -> paymentNowCard()
    // 매장결제  -> paymentShop()

    function do_payment(type){
        // 중복예약인지 확인
        $.ajax({
            url: '/data/reserve_payment_ajax.php',
            data : {
                mode : "get_payment_chk",
                artist_id : "<?=$artist_id?>",
                worker : timeResultArray[0].worker,
                year : year,
                month : month,
                day : day,
                hour : start_hour,
                minute : start_minute,
                cellphone : "<?=$user_cellphone?>",
                order_id : "<?=$order_id?>"
            },
            type : 'POST',
            dataType: 'JSON',
            success: function(data){
                console.log(data.data);
                if($.trim(data.data) != 0){
                    alert("중복입니다 메인페이지로 이동하겠습니다.");
                    location.replace('main');
                }else{
                    if(type == 'shop'){
                        paymentShop();
                    }else if(type == 'bank'){
                        paymentNowBank();
                    }else if(type == 'card'){
                        paymentNowCard();
                    }else{
                        alert("error");
                    }
                }
            }
        });
    }

    // 무통장 입금
    function paymentNowBank(){
        console.log("무통장");
        var bank_name = $("#bank_name").val();
        $.ajax({
            url: '/data/reserve_payment_ajax.php',
            data : {
                mode : "payment_bank",
                pet_seq : "<?=$pet_seq?>",
                artist_id : "<?=$artist_id?>",
                order_id : "<?=$order_id?>",
                is_vat : is_vat,
                worker : timeResultArray[0].worker,
                year : year,
                month : month,
                day : day,
                hour : start_hour,
                to_hour : end_hour,
                minute : start_minute,
                to_minute : end_minute,
                product : product,
                cellphone : "<?=$user_cellphone?>",
                total_price : result_price,
                bank : bank_name,
                expire_time : "<?=$expire_time?>"
            },
            type : 'POST',
            dataType: 'JSON',
            success: function(data){
                if(data.data == "ok"){
                    console.log("sucess");
                    location.href = `reserve_write5?artist_id=<?=$artist_id?>&seq=${data.seq}&pet_seq=<?=$pet_seq?>&payment_type=bank&bank_name=${bank_name}&timeResultArray=${JSON.stringify(timeResultArray)}&serviceResultArray=${JSON.stringify(serviceResultArray)}&etcResultArray=${JSON.stringify(etcResultArray)}`;
                }else if(data.data == 'fail'){
                    console.log("fail");
                }else{
                    console.log("???");
                    console.log(data.data);
                }
            }
        });

    }

    // 카드결제
    function paymentNowCard(){
        console.log("카드");
        $.ajax({
            url: '/data/reserve_payment_ajax.php',
            data : {
                mode : "payment_card",
                pet_seq : "<?=$pet_seq?>",
                artist_id : "<?=$artist_id?>",
                order_id : "<?=$order_id?>",
                is_vat : is_vat,
                worker : timeResultArray[0].worker,
                year : year,
                month : month,
                day : day,
                hour : start_hour,
                to_hour : end_hour,
                minute : start_minute,
                to_minute : end_minute,
                product : product,
                cellphone : "<?=$user_cellphone?>",
                total_price : result_price
            },
            type : 'POST',
            dataType: 'JSON',
            success: function(data){
                if(data.data == "ok"){
                    console.log("sucess");
                    $("#INIpay_form").submit();
                }else if(data.data == 'fail'){
                    console.log("fail");
                }else{
                    console.log("???");
                    console.log(data.data);
                }
            }
        });
    }

    // 매장결제
    function paymentShop(){
        console.log("매장");
        $.ajax({
            url: '/data/reserve_payment_ajax.php',
            data : {
                mode : "payment_shop",
                pet_seq : "<?=$pet_seq?>",
                artist_id : "<?=$artist_id?>",
                order_id : "<?=$order_id?>",
                is_vat : is_vat,
                worker : timeResultArray[0].worker,
                year : year,
                month : month,
                day : day,
                hour : start_hour,
                to_hour : end_hour,
                minute : start_minute,
                to_minute : end_minute,
                product : product,
                cellphone : "<?=$user_cellphone?>",
                total_price : result_price

            },
            type : 'POST',
            dataType: 'JSON',
            success: function(data){
                if($.trim(data.data) == "ok"){
                    console.log(data.seq);
                    location.href = `reserve_write5?artist_id=<?=$artist_id?>&seq=${data.seq}&pet_seq=<?=$pet_seq?>&payment_type=shop&timeResultArray=${JSON.stringify(timeResultArray)}&serviceResultArray=${JSON.stringify(serviceResultArray)}&etcResultArray=${JSON.stringify(etcResultArray)}`;
                }else if($.trim(data.data) == 'fail'){
                    console.log("fail");
                }else{
                    alert("예약과정에서 에러가 났습니다. 메인페이지로 이동합니다.");
                    location.replace('main');
                    console.log(data.data);
                }
            }
        });
    }

    // 하위 네개 모두 선택일시, 하나 부족할때 전체선택 칸
    function is_checkAll(){
        if($("input:checkbox[name=payCard]:checked").length == 8){
            $(".checkAll_now").prop("checked", true);
            $(".checkAll_shop").prop("checked", true);

            $("#submit_reserve").removeClass("disabled");
        }else{
            $(".checkAll_now").prop("checked", false);
            $(".checkAll_shop").prop("checked", false);

            $("#submit_reserve").addClass("disabled");
        }
    }

    // 체크박스 선택
    $(".checkAll_shop").click(function(){
        if($(".checkAll_shop").prop("checked")){
            $(".checkAll_now").prop("checked", true);
            $("input[name=payCard]").prop("checked", true);
        }else{
            $(".checkAll_now").prop("checked", false);
            $("input[name=payCard]").prop("checked", false);
        }
        is_checkAll();
    });
    $(".checkAll_now").click(function(){
        if($(".checkAll_now").prop("checked")){
            $(".checkAll_shop").prop("checked", true);
            $("input[name=payCard]").prop("checked", true);
        }else{
            $(".checkAll_shop").prop("checked", false);
            $("input[name=payCard]").prop("checked", false);
        }
        is_checkAll();
    });

    $(".check_1_shop").click(function(){
        if($(".check_1_shop").prop("checked")){
            $(".check_1_now").prop("checked",true);
        }else{
            $(".check_1_now").prop("checked",false);
        }
        is_checkAll();
    });
    $(".check_1_now").click(function(){
        if($(".check_1_now").prop("checked")){
            $(".check_1_shop").prop("checked",true);
        }else{
            $(".check_1_shop").prop("checked",false);
        }
        is_checkAll();
    });

    $(".check_2_shop").click(function(){
        if($(".check_2_shop").prop("checked")){
            $(".check_2_now").prop("checked",true);
        }else{
            $(".check_2_now").prop("checked",false);
        }
        is_checkAll();
    });
    $(".check_2_now").click(function(){
        if($(".check_2_now").prop("checked")){
            $(".check_2_shop").prop("checked",true);
        }else{
            $(".check_2_shop").prop("checked",false);
        }
        is_checkAll();
    });

    $(".check_3_shop").click(function(){
        if($(".check_3_shop").prop("checked")){
            $(".check_3_now").prop("checked",true);
        }else{
            $(".check_3_now").prop("checked",false);
        }
        is_checkAll();
    });
    $(".check_3_now").click(function(){
        if($(".check_3_now").prop("checked")){
            $(".check_3_shop").prop("checked",true);
        }else{
            $(".check_3_shop").prop("checked",false);
        }
        is_checkAll();
    });

    $(".check_4_shop").click(function(){
        if($(".check_4_shop").prop("checked")){
            $(".check_4_now").prop("checked",true);
        }else{
            $(".check_4_now").prop("checked",false);
        }
        is_checkAll();
    });
    $(".check_4_now").click(function(){
        if($(".check_4_now").prop("checked")){
            $(".check_4_shop").prop("checked",true);
        }else{
            $(".check_4_shop").prop("checked",false);
        }
        is_checkAll();
    });

    // 무통장입금
    $("input:radio[name=pay]").click(function (){
        if($("input:radio[name=pay]:checked").val() == "pay2"){
            $("#bank_payment").css("display","block");
        }else{
            $("#bank_payment").css("display","none");
        }
    });

    // 카드결제
    // accept-charset 지원하지 않는 브라우저 처리용
    function emulAcceptCharset(form) {
        if (form.canHaveHTML) { // detect IE
            document.charset = form.acceptCharset;
        }
        return true;
    }


</script>

</body>
</html>
